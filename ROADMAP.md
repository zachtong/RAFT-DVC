# RAFT-DVC 项目开发路线图

## 项目概述
基于VolRAFT (CVPR 2024)的深度学习数字体积相关(DVC)实现,用于3D变形场估计。

---

## 第一阶段: 核心功能完善 (1-2个月)

### 1.1 训练Pipeline优化 ✅ 已初步完成
**目标**: 建立完整的训练流程

- [x] 核心RAFT-DVC网络架构
  - [x] 特征提取器 (extractor.py)
  - [x] 相关性计算模块 (corr.py)
  - [x] 更新模块 (update.py)
  - [x] 主网络 (raft_dvc.py)

- [ ] 数据加载和处理
  - [ ] 实现通用数据集类(支持多种3D格式: TIFF, NIfTI, HDF5)
  - [ ] 数据增强策略(旋转、缩放、噪声等)
  - [ ] 合成数据生成器完善
  - [ ] 数据预处理pipeline(归一化、裁剪等)

- [ ] 损失函数优化
  - [x] 基础多尺度损失函数
  - [ ] 添加平滑性约束
  - [ ] 边界条件处理
  - [ ] 物理约束损失(可选)

- [ ] 训练策略
  - [ ] 学习率调度器优化
  - [ ] 混合精度训练配置
  - [ ] 梯度累积支持
  - [ ] Early stopping机制
  - [ ] Checkpoint管理优化

**交付物**:
- 完整的训练脚本和配置
- 训练监控和可视化(TensorBoard)
- 实验结果记录系统

---

### 1.2 推理引擎开发 ⏳ 进行中
**目标**: 实现高效的推理系统

- [ ] 推理核心功能
  - [ ] 滑动窗口推理(处理大体积)
  - [ ] 批量推理优化
  - [ ] 内存管理策略
  - [ ] GPU/CPU自适应推理

- [ ] 后处理模块
  - [ ] 流场拼接和平滑
  - [ ] 边界伪影去除
  - [ ] 结果可视化
  - [ ] 输出格式转换(VTK, ParaView兼容)

- [ ] 性能优化
  - [ ] 模型量化(FP16/INT8)
  - [ ] TorchScript导出
  - [ ] ONNX支持
  - [ ] 推理速度基准测试

**交付物**:
- `src/inference/` 完整推理引擎
- 推理脚本和配置示例
- 性能测试报告

---

### 1.3 测试体系建立 ⏳ 待开始
**目标**: 确保代码质量和可靠性

- [ ] 单元测试
  - [ ] 网络模块测试
  - [ ] 数据处理测试
  - [ ] 工具函数测试
  - [ ] 达到80%代码覆盖率

- [ ] 集成测试
  - [ ] 端到端训练测试
  - [ ] 端到端推理测试
  - [ ] 数据流测试

- [ ] 验证测试
  - [ ] 合成数据准确性验证
  - [ ] 与传统DVC方法对比
  - [ ] 消融实验

**交付物**:
- `tests/` 完整测试套件
- CI/CD配置(GitHub Actions)
- 测试覆盖率报告

---

## 第二阶段: 应用开发 (2-3个月)

### 2.1 命令行工具 ⏳ 待开始
**目标**: 提供易用的CLI接口

- [ ] 核心命令
  - [ ] `raft-dvc train` - 训练模型
  - [ ] `raft-dvc infer` - 推理
  - [ ] `raft-dvc eval` - 评估
  - [ ] `raft-dvc export` - 模型导出

- [ ] 辅助命令
  - [ ] `raft-dvc data-gen` - 生成合成数据
  - [ ] `raft-dvc visualize` - 结果可视化
  - [ ] `raft-dvc convert` - 格式转换

**交付物**:
- 完整的CLI工具
- 命令行文档和帮助
- 使用示例

---

### 2.2 GUI应用开发 ⏳ 待开始
**目标**: 提供图形用户界面

**技术栈**: PyQt6 + PyVista/VTK

- [ ] 核心功能模块
  - [ ] 数据加载和预览(3D可视化)
  - [ ] 参数配置界面
  - [ ] 训练监控面板
  - [ ] 推理执行和进度显示
  - [ ] 结果可视化(3D流场、应变场)

- [ ] 高级功能
  - [ ] 批量处理
  - [ ] 结果对比
  - [ ] 报告生成
  - [ ] 项目管理

**交付物**:
- `gui/` 完整GUI应用
- 用户手册
- 安装包(Windows/Linux)

---

### 2.3 工具库完善 ⏳ 待开始
**目标**: 提供通用工具函数

- [ ] 数据处理工具
  - [ ] 格式转换(TIFF, NIfTI, HDF5, VTK)
  - [ ] 体积裁剪和拼接
  - [ ] 重采样和配准

- [ ] 可视化工具
  - [ ] 2D切片可视化
  - [ ] 3D体积渲染
  - [ ] 流场可视化(箭头、流线)
  - [ ] 应变场热图

- [ ] 分析工具
  - [ ] 应变计算
  - [ ] 统计分析
  - [ ] 误差度量

**交付物**:
- `src/utils/` 完整工具库
- API文档
- 使用教程

---

## 第三阶段: 优化和扩展 (3-4个月)

### 3.1 模型优化 ⏳ 待开始

- [ ] 架构改进
  - [ ] 轻量级模型变体
  - [ ] 注意力机制集成
  - [ ] 多尺度特征融合

- [ ] 训练优化
  - [ ] 课程学习策略
  - [ ] 自监督预训练
  - [ ] 迁移学习支持

- [ ] 特殊应用优化
  - [ ] 高分辨率处理优化
  - [ ] 低信噪比数据处理
  - [ ] 大变形场处理

**交付物**:
- 优化模型检查点
- 性能对比报告
- 技术文档

---

### 3.2 文档和教程 ⏳ 待开始

- [ ] API文档
  - [ ] 自动生成API文档(Sphinx)
  - [ ] 代码注释完善
  - [ ] 类型标注

- [ ] 用户文档
  - [ ] 快速开始指南
  - [ ] 安装配置指南
  - [ ] 常见问题FAQ
  - [ ] 故障排除

- [ ] 教程和示例
  - [ ] 基础训练教程
  - [ ] 推理应用教程
  - [ ] GUI使用教程
  - [ ] Jupyter Notebook示例

**交付物**:
- `docs/` 完整文档网站
- Jupyter教程集合
- 视频教程(可选)

---

### 3.3 社区和发布 ⏳ 待开始

- [ ] 代码质量
  - [ ] 代码格式化和规范
  - [ ] 静态类型检查
  - [ ] 性能分析和优化

- [ ] 发布准备
  - [ ] PyPI包发布
  - [ ] Docker镜像
  - [ ] 预训练模型发布
  - [ ] 示例数据集

- [ ] 社区建设
  - [ ] GitHub Issues模板
  - [ ] 贡献指南
  - [ ] 行为准则
  - [ ] 开发者文档

**交付物**:
- PyPI正式发布
- Docker Hub镜像
- 社区运营基础设施

---

## 第四阶段: 高级功能 (4-6个月)

### 4.1 实验性功能 ⏳ 待开始

- [ ] 不确定性估计
- [ ] 主动学习
- [ ] 联邦学习支持
- [ ] 在线学习能力

### 4.2 领域适应 ⏳ 待开始

- [ ] 医学成像应用
- [ ] 材料科学应用
- [ ] 地质学应用
- [ ] 流体力学应用

---

## 当前优先级 (按重要性排序)

1. **[高优先级]** 完善数据加载和数据增强 (阶段1.1)
2. **[高优先级]** 实现推理引擎核心功能 (阶段1.2)
3. **[高优先级]** 建立基础测试体系 (阶段1.3)
4. **[中优先级]** 开发命令行工具 (阶段2.1)
5. **[中优先级]** 完善工具库 (阶段2.3)
6. **[低优先级]** GUI应用开发 (阶段2.2)
7. **[低优先级]** 文档和教程 (阶段3.2)

---

## 里程碑

- **M1 (1个月)**: 完成训练pipeline优化,可以训练和评估模型
- **M2 (2个月)**: 完成推理引擎,支持大体积推理
- **M3 (3个月)**: 建立测试体系,代码覆盖率>80%
- **M4 (4个月)**: 完成CLI工具,发布Alpha版本
- **M5 (5个月)**: 完成GUI应用原型
- **M6 (6个月)**: 完成文档,发布Beta版本
- **M7 (8个月)**: 发布v1.0正式版

---

## 技术栈总结

- **深度学习框架**: PyTorch 2.6+ (CUDA 12.4+)
- **数据处理**: NumPy, SciPy, h5py, nibabel, tifffile
- **可视化**: Matplotlib, PyVista, VTK
- **GUI**: PyQt6
- **测试**: pytest, pytest-cov
- **文档**: Sphinx, MkDocs
- **CI/CD**: GitHub Actions
- **代码质量**: black, flake8, mypy

---

## 参考资料

- [VolRAFT Paper (CVPR 2024)](https://openaccess.thecvf.com/content/CVPR2024W/CV4MS/html/Wong_VolRAFT_Volumetric_Optical_Flow_Network_for_Digital_Volume_Correlation_of_CVPRW_2024_paper.html)
- [VolRAFT GitHub](https://github.com/hereon-mbs/VolRAFT)
- [RAFT Paper](https://arxiv.org/abs/2003.12039)

---

最后更新: 2026-01-28
